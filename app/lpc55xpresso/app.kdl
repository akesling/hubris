app-name "lpc55xpresso"
target "thumbv8m.main-none-eabihf"
board "lpcxpresso55s69"
chip "../../chips/lpc55"
stack-size 1024
secure-separation true
kernel {
    crate-name "lpc55xpresso"
    requires flash=32768 ram=4096
    features "itm"
}
output "bootloader_sram" {
    address 0x14000000
    size 0x8000
}
output "bootloader_flash" {
    address 0x0
    size 0x7000
}
output "bootloader_ram" {
    address 0x20000000
    size 0x4000
}
output "flash" {
    address 0x8000
    size 0x88000
    read
    execute
}
output "ram" {
    address 0x20004000
    size 0x18000
    read
    write
    execute
}
signing {
    combined {
        method "ecc"
        priv-key "../../support/fake_certs/p256-private-key.der"
    }
    bootloader {
        method "rsa"
        priv-key "../../support/fake_certs/fake_private_key.pem"
        root-cert "../../support/fake_certs/fake_certificate.der.crt"
    }
}
bootloader {
    name "stage0"
    imagea-flash-start 32768
    imagea-flash-size 557056
    imagea-ram-start 536887296
    imagea-ram-size 98304
    features {
        - "tz_support"
    }
}

task "jefe" {
    crate-name "task-jefe"
    priority 0
    max-sizes flash=8192 ram=2048
    start
    features "itm"
    stack-size 1536
}

task "hiffy" {
    crate-name "task-hiffy"
    priority 5
    features "lpc55" "gpio" "rng"
    max-sizes flash=32768 ram=16384
    stack-size 2048
    start
    task-slots "gpio_driver" "rng_driver"
}

task "idle" {
    crate-name "task-idle"
    priority 7
    max-sizes flash=256 ram=256
    stack-size 256
    start
}

task "syscon_driver" {
    crate-name "drv-lpc55-syscon"
    priority 2
    max-sizes flash=8192 ram=2048
    uses "syscon" "anactrl" "pmc"
    start
    stack-size 1000
}

task "gpio_driver" {
    crate-name "drv-lpc55-gpio"
    priority 3
    max-sizes flash=8192 ram=2048
    uses "gpio" "iocon"
    start
    stack-size 1000
    task-slots "syscon_driver"
}

task "user_leds" {
    crate-name "drv-user-leds"
    features "lpc55"
    priority 4
    max-sizes flash=8192 ram=2048
    start
    stack-size 1000
    task-slots "gpio_driver"
}

task "usart_driver" {
    crate-name "drv-lpc55-usart"
    priority 4
    max-sizes flash=8192 ram=2048
    uses "flexcomm0"
    start
    notify {
        irq "flexcomm0.irq" mask=0b1
    }
    stack-size 1000
    task-slots "gpio_driver" "syscon_driver"
    config {
        pins {
            - {
                pin {
                    port 0
                    pin 29
                }
                alt 1
            }
            - {
                pin {
                    port 0
                    pin 30
                }
                alt 1
            }
        }
    }
}

task "i2c_driver" {
    crate-name "drv-lpc55-i2c"
    priority 4
    max-sizes flash=8192 ram=2048
    uses "flexcomm4"
    start
    stack-size 1000
    task-slots "gpio_driver" "syscon_driver"
}

task "rng_driver" {
    crate-name "drv-lpc55-rng"
    priority 3
    max-sizes flash=16384 ram=4096
    uses "rng" "pmc"
    start
    stack-size 2200
    task-slots "syscon_driver"
}

task "spi0_driver" {
    crate-name "drv-lpc55-spi-server"
    priority 4
    max-sizes flash=16384 ram=2048
    features "spi0"
    uses "flexcomm8"
    start
    notify {
        irq "flexcomm8.hs_spi" mask=0b1
    }
    stack-size 1000
    task-slots "gpio_driver" "syscon_driver"
    config {
        pins {
            - {
                pin {
                    port 0
                    pin 26
                }
                alt 9
            }
            - {
                pin {
                    port 1
                    pin 3
                }
                alt 6
            }
            - {
                pin {
                    port 1
                    pin 2
                }
                alt 6
            }
            - {
                pin {
                    port 1
                    pin 1
                }
                alt 5
            }
        }
    }
}

task "ping" {
    crate-name "task-ping"
    features "uart"
    priority 6
    max-sizes flash=8192 ram=1024
    start
    stack-size 512
    task-slots peer="pong" "usart_driver"
}

task "pong" {
    crate-name "task-pong"
    priority 5
    max-sizes flash=8192 ram=2048
    start
    stack-size 1000
    task-slots "user_leds"
}

